<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Testing Scientific Software</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">Testing Scientific Software</h1>
          <h2 class="subtitle">Motivation</h2>
<div id="learning-objectives" class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Understand why it's important to test software</li>
</ul>
</div>
</div>
<p>We're given some code that performs an <em>n-body simulation</em> of objects under the influence of gravity; here is the code that <em>advances</em> the system by <em>n</em> time steps:</p>
<h1 id="fixme-should-code-go-here">FIXME: Should code go here?</h1>
<!-- ~~~{.python}
def advance(dt, n, bodies, pairs):

    for i in range(n):
        for (([x1, y1, z1], v1, m1),
             ([x2, y2, z2], v2, m2)) in pairs:
            dx = x1 - x2
            dy = y1 - y2
            dz = z1 - z2
            mag = dt * ((dx * dx + dy * dy + dz * dz) ** (-0.5))
            b1m = m1 * mag
            b2m = m2 * mag
            v1[0] += dx * b2m
            v1[1] += dy * b2m
            v1[2] += dz * b2m
            v2[0] += dx * b1m
            v2[1] += dy * b1m
            v2[2] += dz * b1m
        for (r, [vx, vy, vz], m) in bodies:
            r[0] += dt * vx
            r[1] += dt * vy
            r[2] += dt * vz
~~~ -->

<p>We're also given a script that uses the above code to simulate the motion of the outer planets (Jupiter, Saturn, Uranus and Neptune) around the Sun:</p>
<h1 id="fixme-should-code-go-here-1">FIXME: Should code go here?</h1>
<!-- ~~~ {.python}
from matplotlib.pyplot import *
import matplotlib.animation as animation
from nbody import *

PI = 3.14159265358979323
SOLAR_MASS = 4 * PI * PI
DAYS_PER_YEAR = 365.24

BODIES = {
    'sun': ([0.0, 0.0, 0.0], [0.0, 0.0, 0.0], SOLAR_MASS),

    'jupiter': ([4.84143144246472090e+00,
                 -1.16032004402742839e+00,
                 -1.03622044471123109e-01],
                [1.66007664274403694e-03 * DAYS_PER_YEAR,
                 7.69901118419740425e-03 * DAYS_PER_YEAR,
                 -6.90460016972063023e-05 * DAYS_PER_YEAR],
                9.54791938424326609e-04 * SOLAR_MASS),

    'saturn': ([8.34336671824457987e+00,
                4.12479856412430479e+00,
                -4.03523417114321381e-01],
               [-2.76742510726862411e-03 * DAYS_PER_YEAR,
                4.99852801234917238e-03 * DAYS_PER_YEAR,
                2.30417297573763929e-05 * DAYS_PER_YEAR],
               2.85885980666130812e-04 * SOLAR_MASS),

    'uranus': ([1.28943695621391310e+01,
                -1.51111514016986312e+01,
                -2.23307578892655734e-01],
               [2.96460137564761618e-03 * DAYS_PER_YEAR,
                2.37847173959480950e-03 * DAYS_PER_YEAR,
                -2.96589568540237556e-05 * DAYS_PER_YEAR],
               4.36624404335156298e-05 * SOLAR_MASS),

    'neptune': ([1.53796971148509165e+01,
                 -2.59193146099879641e+01,
                 1.79258772950371181e-01],
                [2.68067772490389322e-03 * DAYS_PER_YEAR,
                 1.62824170038242295e-03 * DAYS_PER_YEAR,
                 -9.51592254519715870e-05 * DAYS_PER_YEAR],
                5.15138902046611451e-05 * SOLAR_MASS) }

SYSTEM = list(BODIES.values())
PAIRS = combinations(SYSTEM)

ims = []

fig, ax = subplots(edgecolor='w')

def step(i):
    cla()
    advance(0.01, 10, SYSTEM, PAIRS)

    x_list = []
    y_list = []

    for body in BODIES:
        [x, y, z] = BODIES[body][0]
        x_list.append(x)
        y_list.append(y)

    line = plot(x_list, y_list, '.')
    axis([-40, 40, -40, 40])
    axis('off')
    return line,

Writer = animation.writers['ffmpeg']
writer = Writer(fps=15, bitrate=1800)

im_ani = animation.FuncAnimation(fig, step, range(500))
im_ani.save('planets.mp4', writer=writer)
~~~ -->

<p>Here is the output from our script: #FIXME: make this GIF prettier #FIXME: explain exactly what the GIF is showing <img src="fig/planets_broken.gif" title="this is the image&#39;s alt text" alt="this is the image&#39;s title" /></p>
<p>It's tempting to be satisfied with this animation - after all, our code seems to be working (no errors), and producing reasonable results (the planets look like they're orbiting the sun).</p>
<p>But some investigation will reveal that the code is actually broken - for instance, it is known that the planets of the Solar System orbit the Sun in nearly the same plane. But the planets in our simulation are clearly <em>not</em> rotating in the same plane.</p>
<p>So we know our code needs fixing. But what's a good way to identify and fix the problem? More importantly, once we've fixed it, how can we guard against introducing more errors as we make changes to our code? For instance, if we change the algorithm</p>
<p>To achieve this, we will write a series of <em>tests</em> for our code. Tests will reveal the source of the problem, and ensure that our code is producing the right answer---or at least, something Close Enoug ---as we continually make changes to it.</p>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
